# Plasma cell-free DNA methylomes for hepatocellular carcinoma (HCC) detection and monitoring of recurrence after liver resection or transplantation

## Introduction
The detection of hepatocellular carcinoma (HCC) via mutational profiling of cell-free DNA (cfDNA) in blood plasma is hampered by mutational diversity and the challenge of acquiring tumor tissue for targeted gene panels. Alternatively, DNA methylation patterns can illuminate biological processes without requiring prior mutation-specific knowledge. Our investigation evaluated the effectiveness of cell-free methylated DNA immunoprecipitation and sequencing (cfMeDIP-Seq) in identifying HCC and monitoring its recurrence after surgery.
This research represents the first application of cfMeDIP-Seq to HCC for both its identification and the tracking of residual disease post-operatively. We collected baseline plasma samples from HCC patients undergoing curative interventions or liver transplants, as well as from healthy individuals, including living liver donors. Utilizing cfMeDIP-Seq and machine learning, we identified HCC-specific differentially methylated regions (DMRs) and developed a HCC methylation score (HMS). This score accurately distinguished HCC with high specificity and sensitivity, and importantly, predicted the likelihood of postoperative recurrence. Analysis of post-surgery follow-up samples using cfMeDIP-Seq revealed that changes in HMS were indicative of future recurrence, demonstrating cfMeDIP-Seq’s utility for both precise HCC detection and recurrence prediction without the need for tumor-specific mutations.  
Our findings demonstrate the potential of cfMeDIP-Seq for sensitive and specific HCC detection irrespective of tumor type, as well as for predicting recurrent disease post-surgery. The comprehensive analysis of tumor-agnostic cfDNA methylomes accurately detected HCC and forecasted recurrence following liver resection or transplantation. This innovative approach may address current challenges in minimally invasive HCC diagnosis using liquid biopsy, offering significant implications for screening, early detection, treatment decisions, and disease progression monitoring and therapy response assessment.

## Contents
The repository contains bash scripts, data processing scripts, and R scripts designed to reproduce figures for the manuscript.

## Setup
R scripts were executed in either R version 3.5.0 or 4.0.1, depending on the specific package dependencies (listeded in Table 1), utilizing RStudio versions (2022.12.0+353 ~ 2023.12.0+369).  

The R packages required are detailed within each script.  

Bash scripts were run on the high performance computing (HPC) cluster at the Princess Margaret Genomics Centre (University Health Network).

## Workflow
![Graphical_abstract](https://github.com/pughlab/HCC_cfMeDIP/assets/109993615/91b31a5c-1920-4214-99c9-5d5c28981fb4)

## List of tools
| Tool                                                                                | Function                                                                                          | Version                                                                      | Running Platform                                                                                 | Language                                                                                             | Alternative                                                                             | Link                                                                                                                                |
| :---------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------- |
| *FastQC*                                                                            | FASTQ QC                                                                                          | 0.11.5                                                                       | H4H, shell                                                                                       | <div style="text-align:center">Java</div>                                                            |                                                                                         | <span style="font-size: 16px;">http://www.bioinformatics.babraham.ac.uk/projects/fastqc</span>                                      |
| <div style="display: flex; align-items: center; height: 50px;"> *MultiQC*</div>     | <div style="display: flex; align-items: center; height: 30px;">􀄵FASTQ QC</div>􀄵count reads      | <div style="display: flex; align-items: center; height: 50px;">1.7</div>     | <div style="display: flex; align-items: center; height: 50px;">H4H, shell</div>                  | <div style="display: flex; align-items: center; justify-content: center; height: 40px;">Python</div> |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://multiqc.info</div>                                           |
| <div style="display: flex; align-items: center; height: 70px;">*fastp*</div>        | <div style="display: flex; align-items: center; height: 40px;">􀄵IFSD 􀄫 QC3</div>􀄵trim          | <div style="display: flex; align-items: center;height: 70px;">0.23.1</div>   | <div style="display: flex; align-items: center; height: 70px;">H4H, shell</div>                  | <div style="display: flex; align-items: center; justify-content: center; height: 70px;">C++</div>    | 􀄵Trim Galore<br>􀄵Trimmomatic<br>􀄵Cutadapt                                            | <div style="display: flex; align-items: center; height: 70px;">https://github.com/OpenGene/fastp</div>                              |
| *bowtie2*                                                                           | align                                                                                             | 2.4.5                                                                        | H4H, shell                                                                                       | <div style="text-align:center">C++</div>                                                             | BWA-mem                                                                                 | https://bowtie-bio.sourceforge.net/bowtie2/index.shtml                                                                              |
| *qualimap*                                                                          | BAM QC                                                                                            | 2.2                                                                          | H4H, shell                                                                                       | <div style="text-align:center">Java</div>                                                            |                                                                                         | http://qualimap.conesalab.org                                                                                                       |
| *SAMtools*                                                                          | sort - index                                                                                      | 1.14                                                                         | H4H, shell                                                                                       | <div style="text-align:center">C</div>                                                               | Picard                                                                                  | http://www.htslib.org                                                                                                               |
| <div style="display: flex; align-items: center; height: 50px;">*sambamba*</div>     | <div style="display: flex; align-items: center; height: 50px;">deduplicate</div>                  | <div style="display: flex; align-items: center; height: 50px;">0.7.0</div>   | <div style="display: flex; align-items: center; height: 50px;">H4H, shell</div>                  | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">D</div>      | <div style="display: flex; align-items: center; height: 30px;">􀄵SAMtools</div>􀄵Picard | <div style="display: flex; align-items: center; height: 50px;">https://lomereiter.github.io/sambamba</div>                          |
| <div style="display: flex; align-items: center; height: 70px;">*MEDIPS*</div>       | 􀄵QC2<br>􀄵generate wig<br>􀄵DMRs/ROIs (edgeR)                                                    | <div style="display: flex; align-items: center; height: 70px;">1.50.0</div>  | <div style="display: flex; align-items: center; height: 70px;">H4H, R/**3.5.0**</div>            | <div style="display: flex; align-items: center; justify-content: center; height: 70px;">R</div>      | <div style="display: flex; align-items: center; height: 70px;">DESeq2</div>             | <div style="display: flex; align-items: center; height: 70px;">https://doi.org/doi:10.18129/B9.bioc.MEDIPS</div>                    |
| *MeDEStrand*                                                                        | absolute methylation levels                                                                       | 0.0.0.9000                                                                   | H4H, R/**3.5.0**                                                                                 | <div style="text-align:center">R</div>                                                               |                                                                                         | https://github.com/jxu1234/MeDEStrand                                                                                               |
| *sva* /*ComBat_seq*                                                                 | reduce batch effect                                                                               | 3.46.0                                                                       | H4H, R/**4.0.1**                                                                                 | <div style="text-align:center">R</div>                                                               |                                                                                         | https://github.com/zhangyuqing/ComBat-seq                                                                                           |
| <div style="display: flex; align-items: center; height: 50px;">*edgeR*</div>        | 􀄵TMM normalization<br>􀄵CPM counts                                                               | <div style="display: flex; align-items: center; height: 50px;">3.28.0</div>  | <div style="display: flex; align-items: center; height: 50px;">H4H, R/**4.0.1**</div>            | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://bioconductor.org/packages/release/bioc/html/edgeR.html</div> |
| <div style="display: flex; align-items: center; height: 70px;">*limma*</div>        | 􀄵voom counts (v-counts)<br>􀄵DMRs (CPM/limma-trend)<br>􀄵DMRs (v-count/limma-voom)               | <div style="display: flex; align-items: center; height: 70px;">3.42.0</div>  | <div style="display: flex; align-items: center; height: 40px;">􀄵H4H, R/**4.0.1**</div>􀄵RStudio | <div style="display: flex; align-items: center; justify-content: center; height: 70px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 70px;">https://bioconductor.org/packages/release/bioc/html/limma.html</div> |
| *FactoMineR*<br>*factoextra*                                                        | <div style="display: flex; align-items: center; height: 50px;">PCA</div>                          | 2.8<br>1.0.7                                                                 | 􀄵H4H, R/**4.0.1**<br>􀄵RStudio                                                                  | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://rpkgs.datanovia.com/factoextra/index.html</div>              |
| <div style="display: flex; align-items: center; height: 50px;">*randomForest*</div> | 􀄵build & train models<br>􀄵classification predictions                                            | <div style="display: flex; align-items: center; height: 50px;">4.7.1.1</div> | 􀄵H4H, R/**3.5.0**<br>􀄵RStudio                                                                  | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://www.stat.berkeley.edu/users/breiman/RandomForests</div>      |
| <div style="display: flex; align-items: center; height: 50px;">*glmnet*</div>       | <div style="display: flex; align-items: center; height: 50px;">regularized linear modeling</div>  | <div style="display: flex; align-items: center; height: 50px;">4.1.7</div>   | 􀄵H4H, R/**3.5.0**<br>􀄵RStudio                                                                  | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://glmnet.stanford.edu/index.html</div>                         |
| <div style="display: flex; align-items: center; height: 50px;">*caret*</div>        | <div style="display: flex; align-items: center; height: 50px;">model training configuration</div> | <div style="display: flex; align-items: center; height: 50px;">6.0</div>     | 􀄵H4H, R/**3.5.0**<br>􀄵RStudio                                                                  | <div style="display: flex; align-items: center; justify-content: center; height: 50px;">R</div>      |                                                                                         | <div style="display: flex; align-items: center; height: 50px;">https://topepo.github.io/caret</div>                                 |
| *pROC*                                                                              | AUROC                                                                                             | 1.18.0                                                                       | RStudio                                                                                          | <div style="text-align:center">R</div>                                                               |                                                                                         | https://xrobin.github.io/pROC                                                                                                       |
| *ggplot2*                                                                           |                                                                                                   | 3.4.2                                                                        | RStudio                                                                                          | <div style="text-align:center">R</div>                                                               |                                                                                         | https://ggplot2.tidyverse.org                                                                                                       |

### H4H - R Compatibility Chart
|      Package | Version    | H4H/R3.5 | H4H/R4.0 | H4H/R4.2 | --mem  | Running Time |
| -----------: | :--------- | :------: | :------: | :------: | ------ | ------------ |
|       MEDIPS | 1.50.0     |   ✅    |    ✅     |  ❌  | ≥ 180G | ~1 day       |
|   MeDEStrand | 0.0.0.9000 |    ✅    |  ❌  |  ❌  | ≥ 180G | 1~2 days     |
|        ChAMP | 2.28.0     |  ❌  |    ✅     |    NA    | ≥ 300G | 1~2 days     |
|       DESeq2 | 1.38.2     |    ✅     |  ❌  |    ✅     | ≥ 180G | ~1 day       |
|        limma | 3.42.0     |    ✅     |    ✅     |    ✅     |        | 1~2 days     |
|        edgeR | 3.28.0     |    ✅     |    ✅    |  ❌  |        | 1~2 days     |
|   FactoMineR | 2.8        |  ❌  |    ✅    |    ✅    |        |              |
|   factoextra | 1.0.7      |  ❌  |    ✅     |    ✅     |        |              |
|        dplyr | 1.1.1      |    ✅    |  ❌  |    ✅     |        |              |
|        tidyr | 1.3.0      |    ✅     |  ❌  |    ✅     |        |              |
|          sva | 3.46.0     |  ❌ |    ✅     |  ❌ | ≥ 500G | ~1 day       |
|        caret | 6.0        |    ✅     |  ❌  |  ❌ | ≥ 80G  | ~2 days      |
| randomForest | 4.7.1.1    |    ✅    |    ✅     | ❌  | ≥ 80G  | ~2 days      |
|       glmnet | 4.1.7      |    ✅     |  ❌  |  ❌  | ≥ 80G  | ~2 days      |
